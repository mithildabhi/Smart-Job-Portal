{% extends 'student_base.html' %}
{% load static %}

{% block title %}My Profile - Smart Job Portal{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/student_profile.css' %}">
{% endblock %}

{% block content %}
<!-- Profile Header -->
<div class="profile-header">
  <div class="profile-content">
    <div class="profile-avatar" id="profile-avatar-container">
      {% if profile.profile_picture %}
        <img src="{{ profile.profile_picture.url }}" alt="Profile Picture" id="profile-image">
        <div class="avatar-overlay">
          <div class="avatar-actions">
            <button class="btn-avatar-action" onclick="openImageModal()" title="Change Picture">
              <i class="fas fa-camera"></i>
            </button>
            <button class="btn-avatar-action" onclick="deleteProfilePicture()" title="Delete Picture">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      {% else %}
        <i class="fas fa-user-graduate" id="default-avatar"></i>
        <div class="avatar-overlay">
          <button class="btn-avatar-action" onclick="openImageModal()" title="Add Picture">
            <i class="fas fa-camera"></i>
          </button>
        </div>
      {% endif %}
    </div>
    <h1 class="profile-name">
      {% if user.first_name %}
        {{ user.first_name }} {{ user.last_name }}
      {% else %}
        {{ user.username }}
      {% endif %}
    </h1>
    <p class="profile-subtitle">Computer Science Student • Looking for Opportunities</p>
  </div>
</div>

<!-- Image Upload Modal -->
<div class="modal fade" id="imageUploadModal" tabindex="-1" aria-labelledby="imageUploadModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="imageUploadModalLabel">
          {% if profile.profile_picture %}
            Update Profile Picture
          {% else %}
            Add Profile Picture
          {% endif %}
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="profile-picture-form" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="modal-body">
          <div class="mb-3">
            <label for="profile-picture-input" class="form-label">Choose Image</label>
            <input type="file" class="form-control" id="profile-picture-input" name="profile_picture" accept="image/*" required>
            <div class="form-text">Max file size: 5MB. Supported formats: JPG, PNG, GIF</div>
          </div>
          <div id="image-preview-container" class="mt-3" style="display: none;">
            <img id="image-preview" src="#" alt="Preview" class="img-fluid rounded" style="max-height: 200px;">
          </div>
          <div id="upload-errors" class="alert alert-danger" style="display: none;"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary" id="upload-btn">
            <span id="upload-btn-text">Upload Picture</span>
            <span id="upload-spinner" class="spinner-border spinner-border-sm ms-2" style="display: none;"></span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Profile Sections -->
<div class="profile-sections">
  
  <!-- Personal Information -->
  <div class="profile-card">
    <h2 class="section-title">
      <i class="fas fa-user section-icon"></i>
      Personal Information
    </h2>
    
    <div class="info-row">
      <span class="info-label">
        <i class="fas fa-envelope"></i>
        Email
      </span>
      <span class="info-value">{{ user.email }}</span>
    </div>
    
    <div class="info-row">
      <span class="info-label">
        <i class="fas fa-phone"></i>
        Phone
      </span>
      <span class="info-value">
        {% if profile.phone %}{{ profile.phone }}{% else %}Not provided{% endif %}
      </span>
    </div>
    
    <div class="info-row">
      <span class="info-label">
        <i class="fas fa-map-marker-alt"></i>
        Location
      </span>
      <span class="info-value">
        {% if profile.location %}{{ profile.location }}{% else %}Not provided{% endif %}
      </span>
    </div>
    
    <div class="info-row">
      <span class="info-label">
        <i class="fas fa-birthday-cake"></i>
        Date of Birth
      </span>
      <span class="info-value">
        {% if profile.date_of_birth %}{{ profile.date_of_birth }}{% else %}Not provided{% endif %}
      </span>
    </div>
    
    <div class="info-row">
      <span class="info-label">
        <i class="fas fa-linkedin"></i>
        LinkedIn
      </span>
      <span class="info-value">
        {% if profile.linkedin_url %}{{ profile.linkedin_url }}{% else %}Not provided{% endif %}
      </span>
    </div>
    
    <a href="#" class="btn-edit">
      <i class="fas fa-edit me-2"></i>Edit Information
    </a>
  </div>

  <!-- Skills & Expertise -->
  <div class="profile-card">
    <h2 class="section-title">
      <i class="fas fa-cogs section-icon"></i>
      Skills & Expertise
    </h2>
    
    <div class="progress-bar-container">
      <div class="progress-label">
        <span>Python</span>
        <span>90%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 90%"></div>
      </div>
    </div>
    
    <div class="progress-bar-container">
      <div class="progress-label">
        <span>JavaScript</span>
        <span>85%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 85%"></div>
      </div>
    </div>
    
    <div class="progress-bar-container">
      <div class="progress-label">
        <span>Django</span>
        <span>80%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 80%"></div>
      </div>
    </div>
    
    <div class="progress-bar-container">
      <div class="progress-label">
        <span>React</span>
        <span>75%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 75%"></div>
      </div>
    </div>
    
    <div class="skill-tags">
      <span class="skill-tag">Python</span>
      <span class="skill-tag">Django</span>
      <span class="skill-tag">JavaScript</span>
      <span class="skill-tag">React</span>
      <span class="skill-tag">Node.js</span>
      <span class="skill-tag">MySQL</span>
      <span class="skill-tag">Git</span>
      <span class="skill-tag">AWS</span>
    </div>
    
    <a href="#" class="btn-edit">
      <i class="fas fa-plus me-2"></i>Add Skills
    </a>
  </div>

  <!-- Education -->
  <div class="profile-card">
    <h2 class="section-title">
      <i class="fas fa-graduation-cap section-icon"></i>
      Education
    </h2>
    
    <div class="education-item">
      <div class="item-title">Bachelor of Engineering in Computer Science</div>
      <div class="item-subtitle">
        {% if profile.college %}{{ profile.college }}{% else %}Mumbai University{% endif %}
      </div>
      <div class="item-duration">2020 - 2024 • Expected</div>
      <div class="item-description">
        CGPA: 8.5/10 • Relevant coursework: Data Structures, Algorithms, Web Development, Database Management, Software Engineering
      </div>
    </div>
    
    <a href="#" class="btn-edit">
      <i class="fas fa-plus me-2"></i>Add Education
    </a>
  </div>

  <!-- Experience -->
  <div class="profile-card">
    <h2 class="section-title">
      <i class="fas fa-briefcase section-icon"></i>
      Experience
    </h2>
    
    <div class="experience-item">
      <div class="item-title">Web Development Intern</div>
      <div class="item-subtitle">TechStart Solutions</div>
      <div class="item-duration">June 2023 - August 2023 • 3 months</div>
      <div class="item-description">
        Developed responsive web applications using Django and React. Collaborated with senior developers to implement new features and optimize database queries.
      </div>
    </div>
    
    <a href="#" class="btn-edit">
      <i class="fas fa-plus me-2"></i>Add Experience
    </a>
  </div>

  <!-- Projects -->
  <div class="profile-card">
    <h2 class="section-title">
      <i class="fas fa-code section-icon"></i>
      Projects
    </h2>
    
    <div class="experience-item">
      <div class="item-title">E-Commerce Platform</div>
      <div class="item-subtitle">Django, React, PostgreSQL</div>
      <div class="item-duration">March 2024 - May 2024</div>
      <div class="item-description">
        Built a full-stack e-commerce platform with user authentication, product catalog, shopping cart, and payment integration.
      </div>
    </div>
    
    <a href="#" class="btn-edit">
      <i class="fas fa-plus me-2"></i>Add Project
    </a>
  </div>

  <!-- Statistics -->
  <div class="profile-card">
    <h2 class="section-title">
      <i class="fas fa-chart-bar section-icon"></i>
      Profile Statistics
    </h2>
    
    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-number">15</div>
        <div class="stat-label">Profile Views</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">8</div>
        <div class="stat-label">Applications</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">3</div>
        <div class="stat-label">Interviews</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">95%</div>
        <div class="stat-label">Profile Complete</div>
      </div>
    </div>
  </div>

</div>

<!-- Back to Dashboard -->
<div class="text-center mt-4 mb-5">
  <a href="{% url 'students:student_dashboard' %}" class="btn-edit">
    <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
  </a>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Pass Django URLs to JavaScript
window.profileUrls = {
    deleteProfilePicture: "{% url 'students:delete_profile_picture' %}",
    uploadProfilePicture: "{% url 'students:upload_profile_picture' %}"
};
</script>
<script src="{% static 'js/student_profile.js' %}"></script>
{% endblock %}
