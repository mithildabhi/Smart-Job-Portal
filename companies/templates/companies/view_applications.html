{{% extends 'company_base.html' %}

{% block title %}View Applications - {{ company.company_name }}{% endblock %}

{% block content %}
<!-- Your existing view applications content -->

<style>
  .applications-header {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border-radius: 20px;
    padding: 2.5rem;
    margin-bottom: 3rem;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .applications-header::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
    animation: float 6s ease-in-out infinite;
  }

  @keyframes float {
    0%, 100% { transform: translate(0px, 0px) rotate(0deg); }
    33% { transform: translate(30px, -30px) rotate(120deg); }
    66% { transform: translate(-20px, 20px) rotate(240deg); }
  }

  .header-content {
    position: relative;
    z-index: 2;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 3rem;
  }

  .stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    text-align: center;
    border-top: 4px solid #667eea;
    transition: all 0.3s ease;
  }

  .stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
  }

  .stat-number {
    font-size: 2rem;
    font-weight: 700;
    color: #667eea;
    margin-bottom: 0.5rem;
  }

  .stat-label {
    color: #6c757d;
    font-weight: 500;
  }

  .filters-section {
    background: white;
    border-radius: 15px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
  }

  .job-section {
    background: white;
    border-radius: 15px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    border-left: 4px solid #667eea;
  }

  .job-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
  }

  .job-stats {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .job-stat-item {
    background: #f8f9ff;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.9rem;
    color: #667eea;
    font-weight: 600;
  }

  .application-card {
    background: #f8f9ff;
    border-radius: 10px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    border-left: 3px solid #667eea;
    transition: all 0.3s ease;
  }

  .application-card:hover {
    transform: translateX(5px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
  }

  .applicant-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .applicant-name {
    font-size: 1.2rem;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 0.25rem;
  }

  .application-info {
    color: #6c757d;
    font-size: 0.9rem;
  }

  .status-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .status-pending { background: #fff3cd; color: #856404; }
  .status-reviewed { background: #d4edda; color: #155724; }
  .status-accepted { background: #d1ecf1; color: #0c5460; }
  .status-rejected { background: #f8d7da; color: #721c24; }

  .application-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-top: 1rem;
  }

  .btn-action {
    padding: 0.5rem 1rem;
    border-radius: 20px;
    border: none;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    font-size: 0.9rem;
    cursor: pointer;
  }

  .btn-view { background: #667eea; color: white; }
  .btn-accept { background: #28a745; color: white; }
  .btn-reject { background: #dc3545; color: white; }
  .btn-contact { background: #17a2b8; color: white; }

  .btn-action:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    color: white;
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: #6c757d;
  }

  .filter-form {
    display: flex;
    gap: 1rem;
    align-items: end;
    flex-wrap: wrap;
  }

  .form-group {
    min-width: 200px;
  }

  .form-control {
    border: 2px solid #e9ecef;
    border-radius: 10px;
    padding: 0.5rem 1rem;
    transition: all 0.3s ease;
  }

  .form-control:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    outline: none;
  }
</style>

<!-- Header -->
<div class="applications-header">
  <div class="header-content">
    <h1>Job Applications</h1>
    <p>{{ company.company_name }} • Application Management Center</p>
  </div>
</div>

<!-- Statistics -->
<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-number">{{ total_applications }}</div>
    <div class="stat-label">Total Applications</div>
  </div>
  <div class="stat-card">
    <div class="stat-number">{{ pending_applications }}</div>
    <div class="stat-label">Pending Review</div>
  </div>
  <div class="stat-card">
    <div class="stat-number">{{ accepted_applications }}</div>
    <div class="stat-label">Accepted</div>
  </div>
  <div class="stat-card">
    <div class="stat-number">{{ rejected_applications }}</div>
    <div class="stat-label">Rejected</div>
  </div>
</div>

<!-- Filters -->
<div class="filters-section">
  <h5 class="mb-3"><i class="fas fa-filter me-2"></i>Filter Applications</h5>
  <form method="get" class="filter-form">
    <div class="form-group">
      <label for="job" class="form-label">Filter by Job</label>
      <select name="job" id="job" class="form-control">
        <option value="all">All Jobs</option>
        {% for job in company_jobs %}
          <option value="{{ job.id }}" {% if job_filter == job.id|stringformat:"s" %}selected{% endif %}>
            {{ job.title }}
          </option>
        {% endfor %}
      </select>
    </div>
    <div class="form-group">
      <label for="status" class="form-label">Filter by Status</label>
      <select name="status" id="status" class="form-control">
        <option value="all">All Status</option>
        <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>Pending</option>
        <option value="reviewed" {% if status_filter == 'reviewed' %}selected{% endif %}>Reviewed</option>
        <option value="accepted" {% if status_filter == 'accepted' %}selected{% endif %}>Accepted</option>
        <option value="rejected" {% if status_filter == 'rejected' %}selected{% endif %}>Rejected</option>
      </select>
    </div>
    <div class="form-group">
      <button type="submit" class="btn btn-primary">
        <i class="fas fa-search me-2"></i>Filter
      </button>
    </div>
  </form>
</div>

<!-- Applications by Job -->
{% if jobs_with_applications %}
  {% for job_data in jobs_with_applications %}
    <div class="job-section">
      <div class="job-title">
        <div>
          <div>{{ job_data.job.title }}</div>
          <div class="text-muted" style="font-size: 0.9rem; font-weight: normal;">
            <i class="fas fa-map-marker-alt me-2"></i>{{ job_data.job.location }}
            • Posted {{ job_data.job.posted_on|timesince }} ago
          </div>
        </div>
        <div class="job-stats">
          <span class="job-stat-item">{{ job_data.application_count }} total</span>
          <span class="job-stat-item">{{ job_data.pending_count }} pending</span>
          <span class="job-stat-item">{{ job_data.accepted_count }} accepted</span>
        </div>
      </div>
      
      {% for application in job_data.applications %}
        <div class="application-card">
          <div class="applicant-header">
            <div>
              <div class="applicant-name">
                <i class="fas fa-user me-2"></i>{{ application.student.first_name }} {{ application.student.last_name }}
              </div>
              <div class="application-info">
                <i class="fas fa-envelope me-2"></i>{{ application.student.email }}
                <br>
                <i class="fas fa-calendar me-2"></i>Applied {{ application.applied_on|timesince }} ago
              </div>
            </div>
            <div>
              {% if application.status %}
                <span class="status-badge status-{{ application.status }}">{{ application.status|title }}</span>
              {% endif %}
            </div>
          </div>
          
          <div class="application-actions">
            <a href="#" class="btn-action btn-view" onclick="viewProfile({{ application.student.id }})">
              <i class="fas fa-eye me-1"></i>View Profile
            </a>
            <a href="mailto:{{ application.student.email }}" class="btn-action btn-contact">
              <i class="fas fa-envelope me-1"></i>Contact
            </a>
            {% if application.status != 'accepted' %}
              <button class="btn-action btn-accept" onclick="updateStatus({{ application.id }}, 'accepted')">
                <i class="fas fa-check me-1"></i>Accept
              </button>
            {% endif %}
            {% if application.status != 'rejected' %}
              <button class="btn-action btn-reject" onclick="updateStatus({{ application.id }}, 'rejected')">
                <i class="fas fa-times me-1"></i>Reject
              </button>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% endfor %}
{% else %}
  <div class="empty-state">
    <i class="fas fa-inbox" style="font-size: 4rem; color: #e9ecef; margin-bottom: 1rem;"></i>
    <h3>No Applications Found</h3>
    <p>
      {% if job_filter != 'all' or status_filter != 'all' %}
        No applications match your current filters. Try adjusting your filter criteria.
      {% else %}
        When candidates apply for your jobs, their applications will appear here.
      {% endif %}
    </p>
    <div class="mt-3">
      {% if job_filter != 'all' or status_filter != 'all' %}
        <a href="{% url 'companies:view_applications' %}" class="btn btn-outline-primary me-2">
          <i class="fas fa-refresh me-2"></i>Clear Filters
        </a>
      {% endif %}
      <a href="{% url 'companies:post_job' %}" class="btn btn-primary">
        <i class="fas fa-plus me-2"></i>Post a Job
      </a>
    </div>
  </div>
{% endif %}

<!-- Back to Dashboard -->
<div class="text-center mt-5 mb-4">
  <a href="{% url 'companies:company_dashboard' %}" class="btn btn-outline-primary me-2">
    <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
  </a>
  <a href="{% url 'companies:manage_jobs' %}" class="btn btn-outline-secondary">
    <i class="fas fa-briefcase me-2"></i>Manage Jobs
  </a>
</div>

<script>
function updateStatus(applicationId, status) {
    if (confirm(`Are you sure you want to ${status} this application?`)) {
        fetch('{% url "companies:update_application_status" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value || '{{ csrf_token }}'
            },
            body: JSON.stringify({
                application_id: applicationId,
                status: status
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error updating application status: ' + (data.error || 'Unknown error'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error updating application status');
        });
    }
}

function viewProfile(studentId) {
    // You can implement this to show student profile in a modal or new page
    alert('Student profile view functionality - to be implemented');
}
</script>

{% endblock %}
